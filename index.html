<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MERMÄ°GRAM - SOHBET PLATFORMU</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Plus+Jakarta+Sans:wght@400;800&display=swap');

        :root {
            --mermi-black: #000000;
            --mermi-accent: #ffcc00; /* Mermi SarÄ±sÄ± */
            --mermi-gray: #0c0c0c;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }

        body {
            background-color: var(--mermi-black);
            color: #ffffff;
            height: 100vh; width: 100vw;
            overflow: hidden; position: fixed;
        }

        /* EKRAN YÃ–NETÄ°MÄ° - BOÅž EKRAN FIX */
        .mermi-screen {
            position: fixed; inset: 0;
            display: none; flex-direction: column;
            background: var(--mermi-black);
            z-index: 10;
        }
        .mermi-screen.active { display: flex !important; }

        .mermi-font { font-family: 'Black Ops One', cursive; }

        /* MAVÄ° TIK EFEKTÄ° */
        .mavi-tik {
            color: #00aaff;
            font-size: 14px;
            margin-left: 5px;
            filter: drop-shadow(0 0 5px rgba(0,170,255,0.4));
        }

        /* VIP GÃ–KKUÅžAÄžI Ä°SÄ°M */
        .vip-rainbow {
            background: linear-gradient(90deg, #ff0000, #ffcc00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rainbowFlow 5s ease infinite;
            font-weight: 900 !important;
        }

        @keyframes rainbowFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* MESAJ BALONLARI */
        .bubble {
            max-width: 85%; padding: 12px;
            border-radius: 20px; background: #111;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .sent .bubble { background: #1a1a1a; border-bottom-right-radius: 2px; }
        .received .bubble { border-bottom-left-radius: 2px; }

        .mermi-btn { transition: 0.2s; cursor: pointer; }
        .mermi-btn:active { transform: scale(0.9); }

        /* MODALLAR */
        .mermi-modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.98);
            z-index: 1000; display: none; align-items: center; justify-content: center;
        }
        .mermi-modal.active { display: flex; }

        /* SCROLLBAR GÄ°ZLEME */
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>

<body class="bg-black text-white">
    <div id="mermi-root">

        <section id="scrAuth" class="mermi-screen active items-center justify-center p-6">
            <div class="w-full max-w-sm text-center">
                <div class="mb-10">
                    <div class="w-24 h-24 bg-yellow-500 rounded-[35px] mx-auto flex items-center justify-center shadow-[0_0_50px_rgba(255,204,0,0.2)]">
                        <i class="fas fa-bolt text-5xl text-black"></i>
                    </div>
                    <h1 class="mermi-font text-4xl mt-6 tracking-widest text-white uppercase">MERMÄ°<span class="text-yellow-500">GRAM</span></h1>
                    <p class="text-gray-600 text-[9px] font-black uppercase tracking-[5px] mt-2">Sohbet Platformu</p>
                </div>

                <div id="loginBox" class="space-y-4">
                    <input type="text" id="inName" class="w-full bg-[#0c0c0c] border border-white/5 p-5 rounded-2xl outline-none focus:border-yellow-500 text-white" placeholder="KullanÄ±cÄ± AdÄ±">
                    <input type="password" id="inPass" class="w-full bg-[#0c0c0c] border border-white/5 p-5 rounded-2xl outline-none focus:border-yellow-500 text-white" placeholder="EriÅŸim Åžifresi">
                    <button onclick="window.mAuth('login')" class="mermi-btn w-full bg-yellow-500 text-black font-black py-5 rounded-2xl shadow-xl">SÄ°STEME BAÄžLAN</button>
                    <button onclick="window.toggleAuth(true)" class="text-gray-700 text-[10px] font-bold uppercase mt-4 block mx-auto">Yeni Hesap OluÅŸtur</button>
                </div>

                <div id="regBox" class="space-y-4 hidden">
                    <input type="text" id="reName" class="w-full bg-[#0c0c0c] border border-white/5 p-5 rounded-2xl outline-none focus:border-green-500 text-white" placeholder="AdÄ±nÄ±z SoyadÄ±nÄ±z">
                    <input type="password" id="rePass" class="w-full bg-[#0c0c0c] border border-white/5 p-5 rounded-2xl outline-none focus:border-green-500 text-white" placeholder="Åžifre Belirle">
                    <button onclick="window.mAuth('reg')" class="mermi-btn w-full bg-green-600 text-white font-black py-5 rounded-2xl shadow-xl">KAYDI TAMAMLA</button>
                    <button onclick="window.toggleAuth(false)" class="text-gray-700 text-[10px] font-bold uppercase mt-4 block mx-auto">GiriÅŸ EkranÄ±na DÃ¶n</button>
                </div>
            </div>
        </section>

        <section id="scrMain" class="mermi-screen">
            <header class="h-16 border-b border-white/5 flex items-center px-5 justify-between bg-black">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-yellow-500 rounded-full flex items-center justify-center text-black shadow-lg shadow-yellow-500/10">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <h2 class="mermi-font text-lg text-white uppercase tracking-wider">MERMÄ°<span class="text-yellow-500">GRAM</span></h2>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="window.openMod('modCreate')" class="mermi-btn text-xl text-white"><i class="fas fa-plus-square"></i></button>
                    <div onclick="window.openMod('modProfile')" class="w-9 h-9 rounded-full border border-white/10 overflow-hidden bg-[#111]" id="topPP"></div>
                </div>
            </header>

            <div id="listArea" class="flex-1 overflow-y-auto pb-20 no-scrollbar">
                <div class="px-5 py-4 bg-[#050505] border-b border-white/5">
                    <span class="text-[9px] font-black text-yellow-500 uppercase tracking-[4px]">Aktif Operasyonlar</span>
                </div>

                <div onclick="window.mOpenChat('global', 'MERMÄ°GRAM GLOBAL')" class="flex items-center p-5 border-b border-white/5 active:bg-white/5 transition-all">
                    <div class="w-14 h-14 rounded-2xl bg-yellow-500 flex items-center justify-center text-2xl mr-4 shadow-xl">
                        <i class="fas fa-globe-americas text-black"></i>
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between mb-1">
                            <h3 class="font-extrabold text-white text-sm uppercase">Global Terminal</h3>
                            <span class="text-[8px] font-black text-yellow-500">CANLI</span>
                        </div>
                        <p class="text-xs text-gray-500 italic">BÃ¼tÃ¼n mermiciler burada.</p>
                    </div>
                </div>

                <div onclick="window.showAydinlatma()" class="flex items-center p-5 border-b border-white/5 bg-yellow-500/5 active:bg-yellow-500/10 transition-all">
                    <div class="w-14 h-14 rounded-2xl bg-[#0c0c0c] border border-yellow-500/20 flex items-center justify-center text-xl mr-4">
                        <i class="fas fa-file-shield text-yellow-500"></i>
                    </div>
                    <div class="flex-1">
                        <h3 class="font-bold text-yellow-500 text-xs uppercase">AydÄ±nlatma Metni ðŸ“œ</h3>
                        <p class="text-[9px] text-gray-500">Yasal haklar ve kullanÄ±m kurallarÄ±.</p>
                    </div>
                </div>

                <div id="dynGroups"></div>
            </div>

            <nav class="fixed bottom-0 left-0 right-0 h-16 bg-[#080808] border-t border-white/10 flex items-center justify-around z-50">
                <button onclick="window.mShowScreen('scrMain')" class="mermi-btn text-2xl text-yellow-500"><i class="fas fa-home"></i></button>
                <button onclick="window.mSearchRadar()" class="mermi-btn text-2xl text-gray-600"><i class="fas fa-magnifying-glass"></i></button>
                <button onclick="window.openMod('modVip')" class="mermi-btn text-2xl text-yellow-500"><i class="fas fa-crown"></i></button>
                <button onclick="window.openMod('modProfile')" class="mermi-btn text-2xl text-gray-600"><i class="fas fa-user-shield"></i></button>
            </nav>
        </section>
        <section id="scrChat" class="mermi-screen">
            <header class="h-16 border-b border-white/5 flex items-center px-2 justify-between bg-black z-50">
                <div class="flex items-center gap-1">
                    <button onclick="window.mShowScreen('scrMain')" class="w-10 h-10 flex items-center justify-center text-xl text-yellow-500">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div class="flex items-center gap-3">
                        <div id="chatPP" class="w-10 h-10 rounded-full bg-[#0c0c0c] border border-white/5 overflow-hidden flex items-center justify-center">
                            <i class="fas fa-bolt text-yellow-500 text-[10px]"></i>
                        </div>
                        <div>
                            <div class="flex items-center gap-1">
                                <h3 id="chatTitle" class="text-xs font-black uppercase tracking-tighter">OPERASYON ODASI</h3>
                                <div id="chatBlueCheck" class="mavi-tik hidden"><i class="fas fa-check-circle"></i></div>
                            </div>
                            <p class="text-[7px] text-green-500 font-bold tracking-[3px] uppercase">Åžifreli BaÄŸlantÄ±</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-2 pr-3">
                    <button class="text-gray-700"><i class="fas fa-phone-slash"></i></button>
                    <button class="text-gray-700"><i class="fas fa-video-slash"></i></button>
                </div>
            </header>

            <div id="msgArea" class="flex-1 overflow-y-auto p-4 space-y-4 bg-black flex flex-col no-scrollbar">
                </div>

            <div id="writePanel" class="p-4 bg-black border-t border-white/5">
                <div class="bg-[#0c0c0c] rounded-2xl px-4 py-1 flex items-center gap-3 border border-white/10 shadow-inner">
                    <button onclick="document.getElementById('fileInp').click()" class="text-lg text-gray-500 hover:text-yellow-500">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <input type="file" id="fileInp" class="hidden" accept="image/*" onchange="window.mHandleFile(this)">
                    
                    <input type="text" id="msgInp" class="flex-1 bg-transparent border-none outline-none text-xs text-white py-4" placeholder="MesajÄ±nÄ± fÄ±rlat...">
                    
                    <button id="sendBtn" onclick="window.mSendMsg()" class="w-10 h-10 bg-yellow-500 rounded-xl text-black flex items-center justify-center active:scale-90 transition shadow-lg">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </section>

<script>
    /* MERMÄ°GRAM V25 CORE SYSTEM */
    const firebaseConfig = {
        apiKey: "AIzaSyDiFa6RjkuqdEbz8L9YsrBD1Be5shgAjUg",
        authDomain: "plane-gr.firebaseapp.com",
        databaseURL: "https://plane-gr-default-rtdb.firebaseio.com",
        projectId: "plane-gr",
        storageBucket: "plane-gr.firebasestorage.app",
        messagingSenderId: "764208760476",
        appId: "1:764208760476:web:19f6aa746f6270ad568f59"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let me = null;
    let curC = null;

    // EKRAN MOTORU
    window.mShowScreen = (id) => {
        document.querySelectorAll('.mermi-screen').forEach(s => s.classList.remove('active'));
        const target = document.getElementById(id);
        if(target) {
            target.classList.add('active');
            gsap.fromTo(target, {opacity: 0}, {opacity: 1, duration: 0.4});
        }
    };

    // VIP KONTROLÃœ (NURULLAH'IN Ä°STEDÄ°ÄžÄ° FIX)
    // Bu fonksiyon artÄ±k Firebase'den gelen gerÃ§ek VIP durumuna gÃ¶re Ã§alÄ±ÅŸÄ±r.
    function checkVipStatus(userData) {
        if(userData.vip === true) {
            return {
                style: 'vip-rainbow',
                tick: true
            };
        } else {
            return {
                style: 'text-gray-500',
                tick: false
            };
        }
    }

    // MESAJLARI DÄ°NLEME
    window.mOpenChat = function(id, title) {
        curC = id;
        window.mShowScreen('scrChat');
        document.getElementById('chatTitle').textContent = title;
        const area = document.getElementById('msgArea');
        area.innerHTML = '';

        db.ref('messages/' + id).off();
        db.ref('messages/' + id).limitToLast(50).on('value', s => {
            if(curC !== id) return;
            area.innerHTML = '';
            s.forEach(child => {
                const m = child.val();
                const isMe = m.uid === me.id;
                
                // VIP Durumunu Veriden Ã‡ek (GerÃ§ek ZamanlÄ±)
                const v = { style: m.vip ? 'vip-rainbow' : 'text-gray-500', tick: m.blueCheck };
                
                area.innerHTML += `
                    <div class="msg-row flex w-full mb-3 ${isMe ? 'justify-end' : 'justify-start'}">
                        <div class="bubble ${isMe ? 'sent' : 'received'}">
                            <div class="flex items-center gap-1 mb-1">
                                <span class="text-[8px] font-black uppercase ${v.style}">${m.sender}</span>
                                ${v.tick ? '<i class="fas fa-check-circle mavi-tik"></i>' : ''}
                            </div>
                            <div class="text-content">
                                ${m.type === 'image' ? `<img src="${m.url}" class="rounded-lg mb-2 max-w-full">` : ''}
                                <p class="text-[12px] text-gray-200">${m.text || ''}</p>
                            </div>
                        </div>
                    </div>`;
            });
            area.scrollTop = area.scrollHeight;
        });
    };
</script>

<script>
    // RADAR ARAMA (@KULLANICI VE GRUP ARAMA)
    window.mSearchRadar = () => {
        const query = prompt("Mermi RadarÄ±: Grup ismi veya @kullanÄ±cÄ± yazÄ±n:").toLowerCase();
        if(!query) return;

        if(query.startsWith('@')) {
            alert("SÄ°STEM: " + query + " adlÄ± kullanÄ±cÄ± takip ediliyor...");
        } else {
            db.ref('groups').once('value', s => {
                let found = false;
                s.forEach(c => {
                    if(c.val().name.toLowerCase().includes(query)) {
                        window.mOpenChat(c.key, c.val().name);
                        found = true;
                    }
                });
                if(!found) alert("Hata: Hedef grup bulunamadÄ±!");
            });
        }
    };

    // VIP SATIN ALMA (SADECE TALEP GÃ–NDERÄ°R, AKTÄ°F ETMEZ)
    window.mBuyVipRequest = () => {
        alert("VIP Talebiniz AlÄ±ndÄ± Nurullah! Ã–deme onayÄ±ndan sonra yÃ¶neticiler Firebase Ã¼zerinden yetkini verecek.");
        window.closeMod('modVip');
    };

    // AYDINLATMA METNÄ°
    window.showAydinlatma = () => {
        alert(`MERMÄ°GRAM AYDINLATMA METNÄ° ðŸ“œ\n\n1. TÃ¼m operasyonlar ÅŸifrelidir.\n2. YasadÄ±ÅŸÄ± paylaÅŸÄ±m yapmak yasaktÄ±r.\n3. VIP yetkisi sadece yÃ¶netici onayÄ±yla verilir.\n4. Mermigram bir yaÅŸam tarzÄ±dÄ±r.`);
    };
</script>

        <div id="modVip" class="mermi-modal" onclick="if(event.target==this) window.closeMod('modVip')">
            <div class="w-[90%] max-w-[380px] bg-[#0c0c0c] border border-yellow-500/30 rounded-[40px] p-8 relative overflow-hidden">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-yellow-500 rounded-full mx-auto flex items-center justify-center text-3xl text-black shadow-lg mb-4">
                        <i class="fas fa-crown"></i>
                    </div>
                    <h2 class="mermi-font text-2xl text-white uppercase">MERMÄ° <span class="text-yellow-500">VIP</span></h2>
                    <p class="text-gray-500 text-[9px] font-black uppercase tracking-widest mt-1">Yetki Talebi OluÅŸtur</p>
                </div>

                <div class="space-y-4 mb-8">
                    <div class="flex items-center gap-4 bg-white/5 p-4 rounded-2xl border border-white/5">
                        <i class="fas fa-check-circle text-yellow-500"></i>
                        <span class="text-[11px] font-bold text-gray-300 uppercase">GÃ¶kkuÅŸaÄŸÄ± Ä°sim Rengi</span>
                    </div>
                    <div class="flex items-center gap-4 bg-white/5 p-4 rounded-2xl border border-white/5">
                        <i class="fas fa-certificate text-blue-500"></i>
                        <span class="text-[11px] font-bold text-gray-300 uppercase">Resmi Mavi TÄ±k OnayÄ±</span>
                    </div>
                </div>

                <a href="https://instagram.com/nemexultra" target="_blank" class="block w-full bg-yellow-500 text-black text-center font-black py-4 rounded-2xl shadow-xl active:scale-95 transition uppercase italic text-sm">
                    SATIN ALMAK Ä°Ã‡Ä°N YAZ
                </a>
                
                <button onclick="window.closeMod('modVip')" class="w-full text-gray-700 text-[10px] font-bold uppercase mt-6 tracking-widest">Kapat</button>
            </div>
        </div>

        <div id="modCreate" class="mermi-modal" onclick="if(event.target==this) window.closeMod('modCreate')">
            <div class="w-[90%] max-w-[400px] bg-[#0a0a0a] border border-white/10 rounded-[45px] p-8 shadow-2xl">
                <h2 class="mermi-font text-2xl text-white mb-8 text-center uppercase tracking-tighter">YENÄ° <span class="text-yellow-500">GRUP</span> KUR</h2>
                
                <div class="space-y-6">
                    <div class="flex flex-col items-center">
                        <div id="groupPPBtn" onclick="document.getElementById('groupFile').click()" class="w-20 h-20 rounded-3xl bg-[#111] border-2 border-dashed border-gray-800 flex items-center justify-center cursor-pointer overflow-hidden">
                            <i class="fas fa-users text-2xl text-gray-700"></i>
                        </div>
                        <input type="file" id="groupFile" class="hidden" accept="image/*" onchange="window.mHandleGroupImg(this)">
                    </div>

                    <input type="text" id="groupName" class="w-full bg-[#0c0c0c] border border-white/5 p-5 rounded-2xl outline-none focus:border-yellow-500 text-white font-bold text-sm" placeholder="Gr
                                      <button onclick="window.mCreateGroup()" class="mermi-btn w-full bg-yellow-500 text-black font-black py-5 rounded-2xl shadow-lg uppercase italic">
                        GRUP OLUÅžTUR
                    </button>
                </div>
            </div>
        </div>

<script>
    // GRUP OLUÅžTURMA (OTO-ALIM FIXLENDÄ°)
    window.mCreateGroup = async function() {
        const name = document.getElementById('groupName').value.trim();
        if(!name) return alert("Grup ismi boÅŸ olamaz!");

        const newGid = db.ref('groups').push().key;
        const groupData = {
            name: name,
            creator: me.id,
            icon: window.tempGroupIcon || "",
            // Ãœye listesine sadece kuran kiÅŸiyi ekle
            members: { [me.id]: true },
            time: Date.now()
        };

        await db.ref('groups/' + newGid).set(groupData);
        alert("SÄ°STEM: Grup baÅŸarÄ±yla kuruldu. Sadece sen Ã¼yesisin!");
        window.closeMod('modCreate');
    };

    // GRUP LÄ°STELEME (SADECE ÃœYESÄ° OLDUÄžUN GRUPLARI GÃ–STERÄ°R)
    function loadGroups() {
        const dynGroups = document.getElementById('dynGroups');
        db.ref('groups').on('value', snapshot => {
            dynGroups.innerHTML = '';
            if(!snapshot.exists()) return;

            snapshot.forEach(child => {
                const g = child.val();
                const gid = child.key;
                
                // FIX: EÄŸer kullanÄ±cÄ± grubun Ã¼yesi deÄŸilse listede gÃ¶sterme
                if(g.members && g.members[me.id]) {
                    const icon = g.icon ? `<img src="${g.icon}" class="w-full h-full object-cover">` : `<div class="w-full h-full flex items-center justify-center bg-[#111] text-yellow-500 font-black text-xl">${g.name[0]}</div>`;
                    
                    dynGroups.innerHTML += `
                        <div onclick="window.mOpenChat('${gid}', '${g.name}')" class="flex items-center p-5 border-b border-white/5 active:bg-white/5 transition-all">
                            <div class="w-14 h-14 rounded-2xl overflow-hidden mr-4 border border-white/10 shadow-lg">${icon}</div>
                            <div class="flex-1">
                                <h3 class="font-bold text-white text-xs uppercase italic tracking-tighter">${g.name}</h3>
                                <p class="text-[9px] text-gray-700 mt-1 uppercase font-black">Operasyon Aktif</p>
                            </div>
                        </div>`;
                }
            });
        });
    }
</script>

        <div id="modProfile" class="mermi-modal" onclick="if(event.target==this) window.closeMod('modProfile')">
            <div class="w-[90%] max-w-[400px] bg-[#0a0a0a] border border-white/5 rounded-[45px] p-8 shadow-[0_0_100px_rgba(0,0,0,1)]">
                <div class="flex flex-col items-center mb-8">
                    <div id="profPP" onclick="document.getElementById('profFile').click()" class="w-24 h-24 rounded-full bg-[#111] border-2 border-yellow-500 p-1 cursor-pointer overflow-hidden flex items-center justify-center shadow-lg shadow-yellow-500/10">
                        <i class="fas fa-camera text-2xl text-yellow-500"></i>
                    </div>
                    <input type="file" id="profFile" class="hidden" accept="image/*" onchange="window.mUpdatePP(this)">
                    <h2 class="mermi-font text-xl mt-4 tracking-tighter uppercase text-white">Profil <span class="text-yellow-500">Merkezi</span></h2>
                </div>

                <div class="space-y-5">
                    <div class="input-group">
                        <label class="text-[8px] font-black text-yellow-500 uppercase tracking-[4px] ml-4 mb-2 block">Kod AdÄ±n</label>
                        <input type="text" id="profName" class="w-full bg-[#0c0c0c] border border-white/5 p-4 rounded-2xl outline-none focus:border-yellow-500 text-white font-bold text-sm">
                    </div>

                    <div class="input-group">
                        <label class="text-[8px] font-black text-yellow-500 uppercase tracking-[4px] ml-4 mb-2 block">Durum Notu</label>
                        <textarea id="profBio" class="w-full bg-[#0c0c0c] border border-white/5 p-4 rounded-2xl outline-none focus:border-yellow-500 text-white text-xs h-20 resize-none" placeholder="Mermigram OperatÃ¶rÃ¼..."></textarea>
                    </div>

                    <button onclick="window.mSaveProfile()" class="mermi-btn w-full bg-white text-black font-black py-5 rounded-2xl shadow-xl uppercase italic text-sm">
                        VERÄ°LERÄ° GÃœNCELLE
                    </button>
                    
                    <button onclick="window.closeMod('modProfile')" class="w-full text-gray-800 text-[10px] font-bold uppercase tracking-[3px]">Geri DÃ¶n</button>
                </div>
            </div>
        </div>

<script>
    // PROFÄ°L VERÄ°LERÄ°NÄ° EKRANA BASMA
    function updateUI() {
        if(!me) return;
        
        const ava = me.avatar ? `<img src="${me.avatar}" class="w-full h-full object-cover">` : `<div class="w-full h-full flex items-center justify-center bg-yellow-500 text-black font-black text-sm">${me.name[0]}</div>`;
        
        document.getElementById('topPP').innerHTML = ava;
        document.getElementById('profPP').innerHTML = ava;
        document.getElementById('profName').value = me.name;
        document.getElementById('profBio').value = me.bio || "";
    }

    // PROFÄ°L GÃœNCELLEME
    window.mSaveProfile = async function() {
        const n = document.getElementById('profName').value.trim();
        const b = document.getElementById('profBio').value.trim();
        if(!n) return;

        await db.ref('users/' + me.id).update({ name: n, bio: b });
        me.name = n; me.bio = b;
        updateUI();
        window.closeMod('modProfile');
        alert("SÄ°STEM: Kimlik verileri gÃ¼ncellendi.");
    };

    // PROFÄ°L FOTOÄžRAFI YÃœKLEME
    window.mUpdatePP = (input) => {
        const file = input.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = async (e) => {
            const base64 = e.target.result;
            await db.ref('users/' + me.id).update({ avatar: base64 });
            me.avatar = base64;
            updateUI();
        };
        reader.readAsDataURL(file);
    };

    // GRUP RESMÄ° Ã–NÄ°ZLEME
    window.mHandleGroupImg = (input) => {
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
            window.tempGroupIcon = e.target.result;
            document.getElementById('groupPPBtn').innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover">`;
        };
        reader.readAsDataURL(file);
    };
</script>

<script>
    // MESAJI FIRLAT (SEND)
    window.mSendMsg = async function() {
        const inp = document.getElementById('msgInp');
        const txt = inp.value.trim();
        if(!txt && !window.tempFile) return;

        // VIP ve Mavi TÄ±k durumunu anlÄ±k olarak kullanÄ±cÄ± verisinden al
        const msgData = {
            uid: me.id,
            sender: me.name,
            text: txt,
            time: Date.now(),
            vip: me.vip || false, // Firebase'de true ise gÃ¶kkuÅŸaÄŸÄ± olur
            blueCheck: me.blueCheck || false, // Firebase'de true ise mavi tÄ±k gelir
            type: window.tempFile ? 'image' : 'text',
            url: window.tempFile || ""
        };

        await db.ref('messages/' + curC).push(msgData);
        inp.value = "";
        window.tempFile = null;
        document.getElementById('sendBtn').classList.remove('shadow-[0_0_20px_rgba(255,204,0,0.5)]');
    };

    // DOSYA EKLEME (CHAT)
    window.mHandleFile = (input) => {
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
            window.tempFile = e.target.result;
            window.mSendMsg(); // Dosya seÃ§ilince otomatik fÄ±rlat
        };
        reader.readAsDataURL(file);
    };

    // Enter TuÅŸu Dinleyici
    document.getElementById('msgInp')?.addEventListener('keypress', (e) => {
        if(e.key === 'Enter') window.mSendMsg();
    });
</script>

<script>
    // GÄ°RÄ°Åž VE KAYIT MANTIÄžI
    window.mAuth = async function(type) {
        if(type === 'login') {
            const name = document.getElementById('inName').value.trim();
            const pass = document.getElementById('inPass').value.trim();
            if(!name || !pass) return alert("AlanlarÄ± doldur!");

            db.ref('users').orderByChild('name').equalTo(name).once('value', s => {
                let found = false;
                s.forEach(c => {
                    if(c.val().password === pass) {
                        me = {id: c.key, ...c.val()};
                        found = true;
                        window.mStartApp();
                    }
                });
                if(!found) alert("Mermi Hedefi BulunamadÄ± (HatalÄ± GiriÅŸ)!");
            });
        } else {
            const name = document.getElementById('reName').value.trim();
            const pass = document.getElementById('rePass').value.trim();
            if(!name || pass.length < 4) return alert("GeÃ§ersiz bilgi!");

            // Yeni mermici kaydÄ±
            const newUser = db.ref('users').push();
            const data = { 
                name, 
                password: pass, 
                vip: false, 
                blueCheck: false, 
                avatar: "", 
                bio: "Mermigram OperatÃ¶rÃ¼" 
            };
            await newUser.set(data);
            me = {id: newUser.key, ...data};
            window.mStartApp();
        }
    };

    // AUTH EKRANI GEÃ‡Ä°ÅžÄ°
    window.toggleAuth = (showReg) => {
        if(showReg) {
            document.getElementById('loginBox').classList.add('hidden');
            document.getElementById('regBox').classList.remove('hidden');
        } else {
            document.getElementById('regBox').classList.add('hidden');
            document.getElementById('loginBox').classList.remove('hidden');
        }
    };

    // UYGULAMAYI BAÅžLAT
    window.mStartApp = () => {
        window.mShowScreen('scrMain');
        updateUI();
        loadGroups();
        console.log("Sistem AteÅŸlendi!");
    };
</script>

<script>
    // MODAL YÃ–NETÄ°MÄ° (GSAP DESTEKLÄ°)
    window.openMod = (id) => {
        const modal = document.getElementById(id);
        if(modal) {
            modal.classList.add('active');
            gsap.fromTo(modal.querySelector('div'), 
                { scale: 0.8, opacity: 0 }, 
                { scale: 1, opacity: 1, duration: 0.3, ease: "back.out(1.7)" }
            );
        }
    };

    window.closeMod = (id) => {
        const modal = document.getElementById(id);
        if(modal) {
            gsap.to(modal.querySelector('div'), { 
                scale: 0.8, 
                opacity: 0, 
                duration: 0.2, 
                onComplete: () => modal.classList.remove('active') 
            });
        }
    };

    // SÄ°STEM MESAJI
    window.onload = () => {
        console.log("%c MERMÄ°GRAM V24 %c BY NEMEXULTRA ", 
            "background:#ffcc00; color:#000; font-weight:bold; padding:5px;", 
            "background:#000; color:#fff; font-weight:bold; padding:5px;");
    };
</script>

    </div> </body>
</html>
