<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MermiChat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); min-height: 100vh; color: white; overflow: hidden; touch-action: manipulation; }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        
        /* 3D Mermi Animasyonu */
        .bullet-wrap { width: 100px; height: 100px; margin: 0 auto 16px; perspective: 1000px; }
        .bullet { width: 30px; height: 80px; margin: 0 auto; position: relative; transform-style: preserve-3d; animation: spin 3s linear infinite; }
        @keyframes spin { 0% { transform: rotateY(0deg) rotateX(10deg); } 100% { transform: rotateY(360deg) rotateX(10deg); } }
        .bullet-body { width: 30px; height: 60px; background: linear-gradient(90deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%); border-radius: 0 0 15px 15px; position: absolute; bottom: 0; box-shadow: inset -3px 0 8px rgba(0,0,0,0.3), 0 0 15px rgba(255,215,0,0.5); }
        .bullet-tip { width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-bottom: 25px solid #c0c0c0; position: absolute; top: 0; }
        .bullet-ring { width: 34px; height: 6px; background: #b8860b; position: absolute; bottom: 15px; left: -2px; border-radius: 2px; }

        .msg-me { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-bottom-right-radius: 4px; align-self: flex-end; margin-left: auto; }
        .msg-other { background: rgba(255, 255, 255, 0.15); border-bottom-left-radius: 4px; align-self: flex-start; }
        .hidden { display: none !important; }
        
        .chat-item { cursor: pointer; transition: all 0.2s; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .message-bubble { max-width: 85%; padding: 10px 14px; border-radius: 18px; margin-bottom: 8px; word-wrap: break-word; font-size: 15px; }
        
        .input-area { position: fixed; bottom: 0; left: 0; right: 0; padding: 12px; background: rgba(22, 33, 62, 0.95); backdrop-filter: blur(10px); border-top: 1px solid rgba(255,255,255,0.1); display: flex; gap: 8px; align-items: center; z-index: 40; }
        .media-btn { width: 44px; height: 44px; border-radius: 50%; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; cursor: pointer; color: white; }
        .send-btn { width: 44px; height: 44px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; cursor: pointer; border: none; color: white; }
        .message-input { flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 22px; padding: 12px 16px; color: white; outline: none; }
        
        .chat-header { position: fixed; top: 0; left: 0; right: 0; z-index: 50; padding: 12px 16px; display: flex; align-items: center; gap: 12px; }
        .messages-container { padding: 80px 16px 100px; overflow-y: auto; height: 100vh; display: flex; flex-direction: column; }
        
        .recording { background: #ef4444 !important; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    </style>
</head>
<body>

    <div id="screen-login" class="flex items-center justify-center min-h-screen p-4">
        <div class="glass rounded-2xl p-6 w-full max-w-sm">
            <div class="bullet-wrap"><div class="bullet"><div class="bullet-tip"></div><div class="bullet-body"><div class="bullet-ring"></div></div></div></div>
            <h1 class="text-3xl font-bold text-center mb-6 bg-gradient-to-r from-purple-400 to-pink-500 bg-clip-text text-transparent">MermiChat</h1>
            <div id="box-login">
                <input type="text" id="user-login" class="w-full p-3 mb-3 bg-white/10 border border-white/20 rounded-xl text-white outline-none" placeholder="Kullanıcı adı">
                <input type="password" id="pass-login" class="w-full p-3 mb-4 bg-white/10 border border-white/20 rounded-xl text-white outline-none" placeholder="Şifre">
                <button onclick="handleLogin()" class="w-full py-3 bg-purple-600 rounded-xl font-bold">Giriş Yap</button>
                <p class="text-center mt-4 text-sm text-gray-400">Hesabın yok mu? <button onclick="toggleAuth(true)" class="text-purple-400 underline">Kayıt Ol</button></p>
            </div>
            <div id="box-register" class="hidden">
                <input type="text" id="user-reg" class="w-full p-3 mb-3 bg-white/10 border border-white/20 rounded-xl text-white outline-none" placeholder="Kullanıcı adı">
                <input type="password" id="pass-reg" class="w-full p-3 mb-4 bg-white/10 border border-white/20 rounded-xl text-white outline-none" placeholder="Şifre">
                <button onclick="handleRegister()" class="w-full py-3 bg-green-600 rounded-xl font-bold">Kayıt Ol</button>
                <p class="text-center mt-4 text-sm text-gray-400">Hesabın var mı? <button onclick="toggleAuth(false)" class="text-green-400 underline">Giriş Yap</button></p>
            </div>
        </div>
    </div>

    <div id="screen-list" class="hidden h-screen flex flex-col">
        <div class="glass p-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center"><i class="fas fa-user"></i></div>
                <div><div id="display-user" class="font-bold"></div><div class="text-xs text-green-400">● Çevrimiçi</div></div>
            </div>
            <button onclick="alert('Profil düzenleme yakında!')" class="w-10 h-10 glass rounded-full flex items-center justify-center"><i class="fas fa-cog"></i></button>
        </div>
        <div class="flex-1 overflow-y-auto" id="chat-list-container">
            <div class="p-4 border-b border-white/5 flex items-center gap-3 glass m-2 rounded-xl" onclick="openChat('ana-grup', 'Ana Grup')">
                <div class="w-12 h-12 rounded-full bg-orange-500 flex items-center justify-center font-bold">A</div>
                <div class="flex-1">
                    <div class="font-bold text-yellow-400">Ana Grup</div>
                    <div class="text-xs text-gray-400">Girmek için dokun...</div>
                </div>
            </div>
        </div>
    </div>

    <div id="screen-chat" class="hidden h-screen flex flex-col bg-[#0f3460]">
        <div class="glass chat-header">
            <button onclick="backToList()" class="w-10 h-10 flex items-center justify-center text-xl"><i class="fas fa-arrow-left"></i></button>
            <div id="chat-avatar" class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center font-bold">A</div>
            <div class="flex-1 font-bold" id="chat-name">Grup</div>
            <button onclick="alert('Üye ekleme/Grup menüsü')" class="w-10 h-10 flex items-center justify-center"><i class="fas fa-ellipsis-v"></i></button>
        </div>
        <div class="messages-container" id="chat-box"></div>
        
        <div class="input-area">
            <label class="media-btn">
                <i class="fas fa-image"></i>
                <input type="file" id="file-image" accept="image/*" class="hidden" onchange="alert('Fotoğraf gönderimi hazır (Firebase Storage gerekli)')">
            </label>
            <button id="btn-voice" class="media-btn" onclick="toggleVoice()"><i class="fas fa-microphone" id="voice-icon"></i></button>
            <input type="text" id="input-msg" class="message-input" placeholder="Mesaj yaz...">
            <button onclick="sendMessage()" class="send-btn"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyDiFa6RjkuqdEbz8L9YsrBD1Be5shgAjUg",
            authDomain: "plane-gr.firebaseapp.com",
            databaseURL: "https://plane-gr-default-rtdb.firebaseio.com",
            projectId: "plane-gr",
            storageBucket: "plane-gr.firebasestorage.app"
        };
        firebase.initializeApp(firebaseConfig);
        var database = firebase.database();
        var myUsername = null;
        var activeGroup = null;
        var isRecording = false;

        function toggleAuth(isReg) {
            document.getElementById('box-login').classList.toggle('hidden', isReg);
            document.getElementById('box-register').classList.toggle('hidden', !isReg);
        }

        function handleLogin() {
            let u = document.getElementById('user-login').value.trim().toLowerCase();
            let p = document.getElementById('pass-login').value;
            if(!u || !p) return;
            database.ref('users/' + u).once('value', s => {
                if(s.exists() && s.val().pass === p) {
                    myUsername = u;
                    document.getElementById('screen-login').classList.add('hidden');
                    document.getElementById('screen-list').classList.remove('hidden');
                    document.getElementById('display-user').innerText = u;
                } else alert("Hata!");
            });
        }

        function handleRegister() {
            let u = document.getElementById('user-reg').value.trim().toLowerCase();
            let p = document.getElementById('pass-reg').value;
            if(!u || p.length < 4) return;
            database.ref('users/' + u).set({ pass: p }).then(() => {
                alert("Kayıt ok!"); toggleAuth(false);
            });
        }

        function openChat(gid, gname) {
            activeGroup = gid;
            document.getElementById('screen-list').classList.add('hidden');
            document.getElementById('screen-chat').classList.remove('hidden');
            document.getElementById('chat-name').innerText = gname;
            loadMessages(gid);
        }

        function backToList() {
            if(activeGroup) database.ref('messages/' + activeGroup).off();
            document.getElementById('screen-chat').classList.add('hidden');
            document.getElementById('screen-list').classList.remove('hidden');
        }

        function loadMessages(gid) {
            const box = document.getElementById('chat-box');
            box.innerHTML = "";
            database.ref('messages/' + gid).off();
            database.ref('messages/' + gid).on('child_added', s => {
                let m = s.val();
                let isMe = m.user === myUsername;
                let div = document.createElement('div');
                div.className = `message-bubble ${isMe ? 'msg-me' : 'msg-other'}`;
                div.innerHTML = `<div class="text-[10px] font-bold opacity-50">${m.user}</div><div>${m.text}</div>`;
                box.appendChild(div);
                box.scrollTop = box.scrollHeight;
            });
        }

        function sendMessage() {
            let inp = document.getElementById('input-msg');
            let txt = inp.value.trim();
            if(!txt || !activeGroup) return;
            database.ref('messages/' + activeGroup).push({
                user: myUsername, text: txt, time: Date.now()
            });
            inp.value = "";
        }

        function toggleVoice() {
            isRecording = !isRecording;
            const btn = document.getElementById('btn-voice');
            const icon = document.getElementById('voice-icon');
            if(isRecording) {
                btn.classList.add('recording');
                icon.className = "fas fa-stop";
            } else {
                btn.classList.remove('recording');
                icon.className = "fas fa-microphone";
                alert("Ses kaydedildi (Göndermek için Firebase Storage/Audio API lazım)");
            }
        }

        document.getElementById('input-msg').onkeypress = (e) => { if(e.key === 'Enter') sendMessage(); };
    </script>
</body>
</html>
